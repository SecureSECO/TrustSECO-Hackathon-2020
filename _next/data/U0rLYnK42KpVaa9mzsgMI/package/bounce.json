{"pageProps":{"postData":{"_id":"5fb0682ba28b82fef5a67ac2","id":"bounce","crawlTimestamp":"14/11/2020 23:28:42","packageName":"bounce","description":"Selective error catching and rewrite rules","repository":{"type":"git","url":"git://github.com/hapijs/bounce.git"},"readme":"# bounce\r\n\r\nSelective error catching and rewrite rules\r\n\r\n[![Build Status](https://secure.travis-ci.org/hapijs/bounce.svg)](http://travis-ci.org/hapijs/bounce)\r\n\r\nLead Maintainer - [Eran Hammer](https://github.com/hueniverse)\r\n\r\n## Introduction\r\n\r\nWorking with `async`/`await` introduces a new challange in handling errors. Unlike callbacks, which\r\nprovide a dual mechanism for passing application errors via the callback `err` argument and\r\ndeveloper errors via exceptions, `await` combines these two channels into one.\r\n\r\nIt is common practice to ignore application errors in background processing or when there is no\r\nuseful fallback. In those cases, it is still imperative to allow developer errors to surface and\r\nnot get swallowed.\r\n\r\nFor more information read:\r\n- [Learning to Throw Again](https://medium.com/@eranhammer/learning-to-throw-again-79b498504d28)\r\n- [Catching without Awaiting](https://medium.com/@eranhammer/catching-without-awaiting-b2cb7df45790)\r\n\r\nFor example:\r\n\r\n```js\r\nasync function email(user) {\r\n\r\n    if (!user.address) {\r\n        throw new Error('User has no email address');\r\n    }\r\n\r\n    const message = 'Welcome!';\r\n    if (user.name) {\r\n        message = `Welcome ${user.name}!`;\r\n    }\r\n\r\n    await mailer.send(user.address, message);\r\n}\r\n\r\nasync function register(address, name) {\r\n\r\n    const user = { address, name };\r\n    const id = await db.user.insert(user);\r\n    user.id = id;\r\n\r\n    try {\r\n        await email(user);\r\n    }\r\n    catch (err) { }             // Ignore errors\r\n\r\n    return user;\r\n}\r\n```\r\n\r\nThis will fail silently every time the user has a `name` because it is reassigning a value to a\r\n`const` variable. However, because `email()` errors are ignored, system errors are ignored as well.\r\nThe idea is that `email()` can be used in both critical and non-critical paths. In the critical\r\npaths, errors are checked and addressed, but in the non-critical paths, errors are simply ignored.\r\n\r\nThis can be solved by adding a `rethrow()` statement:\r\n\r\n```js\r\nconst Bounce = require('bounce');\r\n\r\nasync function register(address, name) {\r\n\r\n    const user = { address, name };\r\n    const id = await db.user.insert(user);\r\n    user.id = id;\r\n\r\n    try {\r\n        await email(user);\r\n    }\r\n    catch (err) {\r\n        Bounce.rethrow(err, 'system');  // Rethrows system errors and ignores application errors\r\n    }\r\n\r\n    return user;\r\n}\r\n```\r\n\r\n## Usage\r\n\r\n### `rethrow(err, types, [options])`\r\n\r\nThrows the error passed if it matches any of the specified rules where:\r\n- `err` - the error.\r\n- `type` - a single item or an array of items of:\r\n    - An error constructor (e.g. `SyntaxError`).\r\n    - `'system'` - matches any languange native error or node assertions.\r\n    - `'boom'` - matches [**boom**](https://github.com/hapijs/boom) errors.\r\n    - an object where each property is compared with the error and must match the error property\r\n      value. All the properties in the object must match the error but do not need to include all\r\n      the error properties.\r\n- `options` - optional object where:\r\n    - `decorate` - an object which is assigned to the `err`, copying the properties onto the error.\r\n    - `override` - an error used to override `err` when `err` matches. If used with `decorate`,\r\n      the `override` object is modified.\r\n    - `return` - if `true`, the error is returned instead of thrown. Defaults to `false`.\r\n\r\n### `ignore(err, types, [options])`\r\n\r\nThe opposite action of `rethrow()`. Ignores any errors matching the specified `types`. Any error\r\nnot matching is thrown after applying the `options`.\r\n\r\n### `background(operation, [action], [types], [options])`\r\n\r\nAwaits for the value to resolve in the background and then apply either the `rethrow()` or `ignore()`\r\nactions where:\r\n- `operation` - a function, promise, or value that is `await`ed on inside a `try...catch` and any\r\n  error thrown processed by the `action` rule.\r\n- `action` - one of `'rethrow'` or `'ignore'`. Defaults to `'rethrow'`.\r\n- `types` - same as the `types` argument passed to `rethrow()` or `ignore()`. Defaults to `'system'`.\r\n- `options` - same as the `options` argument passed to `rethrow()` or `ignore()`.\r\n\r\n### `isBoom(err)`\r\n\r\nReturns `true` when `err` is a [**boom**](https://github.com/hapijs/boom) error.\r\n\r\n### `isError(err)`\r\n\r\nReturns `true` when `err` is an error.\r\n\r\n### `isSystem(err)`\r\n\r\nReturn `true` when `err` is one of:\r\n- `EvalError`\r\n- `RangeError`\r\n- `ReferenceError`\r\n- `SyntaxError`\r\n- `TypeError`\r\n- `URIError`\r\n- Node's `AssertionError`\r\n","homepage":"https://github.com/hapijs/bounce#readme","trustScore":18,"sourceRank":{"basic_info_present":1,"repository_present":1,"readme_present":1,"license_present":1,"versions_present":1,"follows_semver":1,"recent_release":0,"not_brand_new":1,"one_point_oh":1,"dependent_projects":4,"dependent_repositories":3,"stars":2,"contributors":1,"subscribers":0,"all_prereleases":0,"any_outdated_dependencies":0,"is_deprecated":0,"is_unmaintained":0,"is_removed":0,"trustScore":18},"versions":[{"versionNumber":"0.0.0","timestamp":"2017-11-01T20:44:36.465Z","trustScore":18,"dependencies":[{"packageName":"boom","version":"6.x.x"}]},{"versionNumber":"1.0.0","timestamp":"2017-11-02T05:48:38.227Z","trustScore":17,"dependencies":[]},{"versionNumber":"1.0.1","timestamp":"2017-11-02T17:54:58.863Z","trustScore":16,"dependencies":[{"packageName":"hoek","version":"5.x.x"}]},{"versionNumber":"1.0.2","timestamp":"2017-11-03T09:11:39.782Z","trustScore":18,"dependencies":[{"packageName":"boom","version":"7.x.x"},{"packageName":"hoek","version":"5.x.x"}]},{"versionNumber":"1.0.3","timestamp":"2017-11-03T09:40:28.581Z","trustScore":17,"dependencies":[{"packageName":"boom","version":"7.x.x"},{"packageName":"hoek","version":"5.x.x"}]},{"versionNumber":"1.1.0","timestamp":"2017-11-06T07:23:03.309Z","trustScore":18,"dependencies":[{"packageName":"boom","version":"7.x.x"},{"packageName":"hoek","version":"5.x.x"}]},{"versionNumber":"1.2.0","timestamp":"2017-11-06T09:36:41.625Z","trustScore":18,"dependencies":[{"packageName":"boom","version":"7.x.x"},{"packageName":"hoek","version":"5.x.x"}]},{"versionNumber":"1.2.1","timestamp":"2018-11-01T07:32:47.231Z","trustScore":18,"dependencies":[{"packageName":"boom","version":"7.x.x"},{"packageName":"hoek","version":"6.x.x"}]},{"versionNumber":"1.2.2","timestamp":"2018-11-03T00:17:48.404Z","trustScore":17,"dependencies":[{"packageName":"boom","version":"7.x.x"},{"packageName":"hoek","version":"6.x.x"}]},{"versionNumber":"1.2.3","timestamp":"2018-11-11T02:09:15.474Z","trustScore":16,"dependencies":[{"packageName":"boom","version":"7.x.x"},{"packageName":"hoek","version":"6.x.x"}]}]}},"__N_SSG":true}